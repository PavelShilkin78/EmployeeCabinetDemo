импорт ВебApi
импорт Компания
импорт КонтрольДоступа
импорт ЛичныеКабинетыПользователей
импорт СтандартноеПриложение
импорт ФизическиеЛица

// Контракт ПараметрыСеансаПоставщик

@ВПроекте
@Реализация
метод КоллекцияПараметровСеанса(МобильныйИнтерфейс: Булево): Соответствие<Строка, Объект>
    пер ПараметрыСеанса = новый ОценкаПерсонала.ПараметрыСеанса()
    ЗаполнитьПараметрыСеанса(ПараметрыСеанса)
    возврат {ОценкаПерсонала.КЛЮЧ_ПАРАМЕТРОВ_СЕАНСА: ПараметрыСеанса}
;
// Конец ПараметрыСеансаПоставщик

метод ЗаполнитьПараметрыСеанса(ПараметрыСеанса: ОценкаПерсонала.ПараметрыСеанса)
    ПараметрыСеанса.ФункциональныеОпции = ИспользуемаяФункциональность.ФункциональныеОпции()
;

// Контракт ПодсистемаПриложения

@ВПроекте
@Реализация
метод ОписаниеПодсистемы(): СтандартноеПриложение.ОписаниеПодсистемы
    возврат новый СтандартноеПриложение.ОписаниеПодсистемы(
        ОценкаПерсонала.ИД_ПОДСИСТЕМЫ,
        {
            КонтрольДоступа.ИД_ПОДСИСТЕМЫ, 
            ФизЛица.ИД_ПОДСИСТЕМЫ,
            ЛичныеКабинетыПользователей.ИД_ПОДСИСТЕМЫ,
            Компания.ИД_ПОДСИСТЕМЫ
        }
    )
;

// Конец ПодсистемаПриложения

// Контракт ОбновляемаяПодсистема

@ВПроекте
@Реализация
метод ОбработчикиЗаполнения(): Массив<СтандартноеПриложение.ОписаниеОбработчикаЗаполнения>
    пер Обработчики: Массив<СтандартноеПриложение.ОписаниеОбработчикаЗаполнения>
    Обработчики.Добавить(новый СтандартноеПриложение.ОписаниеОбработчикаЗаполнения(
                    ОценкаПерсонала.ИД_ПОДСИСТЕМЫ, 
                    "ОценкаПерсоналаОбновитьСтроковыеРесурсы", 
                    &ОценкаПерсонала.ОбновитьСтроковыеРесурсы()))
    Обработчики.Добавить(новый СтандартноеПриложение.ОписаниеОбработчикаЗаполнения(
                    ОценкаПерсонала.ИД_ПОДСИСТЕМЫ, 
                    "ШкалыОценокЗаполнитьПервоначальныеШкалыОценок",
                    &ШкалыОценок.ПровестиПервоначальноеЗаполнение()))
    возврат Обработчики
;

@ВПроекте
@Реализация
метод ОбработчикиОбновления(): Массив<СтандартноеПриложение.ОписаниеОбработчикаОбновления>
    пер Обработчики: Массив<СтандартноеПриложение.ОписаниеОбработчикаОбновления>
    пер Сервис = ОценкаПерсоналаПоставщикВерсииПриложения.ПолучитьСервис()
    Обработчики.Добавить(новый СтандартноеПриложение.ОписаниеОбработчикаОбновления(
                ОценкаПерсонала.ИД_ПОДСИСТЕМЫ,
                "ОценкаПерсоналаПолномочияЗаполнитьПредопределенныеДанные", 
                &ОценкаПерсонала.ДобавитьПолномочия(),
                Сервис.ОценкаПерсоналаПолномочияЗаполнитьПредопределенныеДанные()))
    Обработчики.Добавить(новый СтандартноеПриложение.ОписаниеОбработчикаОбновления(
                ОценкаПерсонала.ИД_ПОДСИСТЕМЫ,
                "ОценкаПерсоналаЗаполнитьПредопределенныеРоли", 
                &ОценкаПерсонала.ДобавитьРоли(),
                Сервис.ОценкаПерсоналаЗаполнитьПредопределенныеРоли()))
    Обработчики.Добавить(новый СтандартноеПриложение.ОписаниеОбработчикаОбновления(
                ОценкаПерсонала.ИД_ПОДСИСТЕМЫ,
                "ОценкаПерсоналаОбновитьСтроковыеРесурсы", 
                &ОценкаПерсонала.ОбновитьСтроковыеРесурсы(),
                Сервис.ОценкаПерсоналаОбновитьСтроковыеРесурсы()))     
    возврат Обработчики
;

// Конец ОбновляемаяПодсистема

// Контракт ДанныеApi

@ВПроекте
@Реализация
метод МассивТипов(Получатель: ВидПриложения?, ВерсияФорматаОбмена: Версия?): Массив<Тип>
    пер Типы: Массив<Тип>
    если Получатель == ВидПриложения.Hr
        Типы.Добавить(Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.Ссылка>) 
    иначе если Получатель == ВидПриложения.Ess
        Типы.Добавить(Тип<БиблиотекиКомпетенций.Ссылка>) 
        Типы.Добавить(Тип<Компетенции.Ссылка>) 
        Типы.Добавить(Тип<ИндикаторыКомпетенций.Ссылка>)
        Типы.Добавить(Тип<ШкалыОценок.Ссылка>)
        Типы.Добавить(Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.Ссылка>)
    ;
    возврат Типы
;

@ВПроекте
@Реализация
метод ТипДанныхJson(ТипОбъекта: Тип, ВерсияФорматаОбмена: Версия?): Массив<Тип>
    пер Типы: Массив<Тип>
    выбор ТипОбъекта
    когда Тип<БиблиотекиКомпетенций.Ссылка>
        Типы.Добавить(БиблиотекиКомпетенций.ТипДанныхJson(ВерсияФорматаОбмена))
    когда Тип<Компетенции.Ссылка>
        Типы.Добавить(Компетенции.ТипДанныхJson(ВерсияФорматаОбмена))
    когда Тип<ИндикаторыКомпетенций.Ссылка>
        Типы.Добавить(ИндикаторыКомпетенций.ТипДанныхJson(ВерсияФорматаОбмена))
    когда Тип<ШкалыОценок.Ссылка>
        Типы.Добавить(ШкалыОценок.ТипДанныхJson(ВерсияФорматаОбмена))
    когда Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.Ссылка>
        Типы.Добавить(ЭкземплярыОценкиПерсоналаПоМетоду360.ТипДанныхJson(ВерсияФорматаОбмена))
    ;    
    возврат Типы
;

@ВПроекте
@Реализация
метод ТипКоллекцииДанныхJson(ТипОбъекта: Тип, ВерсияФорматаОбмена: Версия?): Массив<Тип>
    пер Типы: Массив<Тип>
    возврат Типы
;

@ВПроекте
@Реализация
метод ИнструментыМенеджераОбъекта(ТипОбъекта: Тип): Массив<ВебApiСервер.ИнструментыМенеджераОбъекта>
    пер НаборИнструментыМенеджераОбъекта: Массив<ВебApiСервер.ИнструментыМенеджераОбъекта>
    пер ИнструментыМенеджераОбъекта: ВебApiСервер.ИнструментыМенеджераОбъекта
    выбор ТипОбъекта
    когда Тип<БиблиотекиКомпетенций.Ссылка>
        ИнструментыМенеджераОбъекта.ЗаписьОбъекта = (Объект: Сущность.Объект) -> (Объект как БиблиотекиКомпетенций.Объект).Записать()
        НаборИнструментыМенеджераОбъекта.Добавить(ИнструментыМенеджераОбъекта)
    когда Тип<Компетенции.Ссылка>
        ИнструментыМенеджераОбъекта.ЗаписьОбъекта = (Объект: Сущность.Объект) -> (Объект как Компетенции.Объект).Записать()
        НаборИнструментыМенеджераОбъекта.Добавить(ИнструментыМенеджераОбъекта)
    когда Тип<ИндикаторыКомпетенций.Ссылка>
        ИнструментыМенеджераОбъекта.ЗаписьОбъекта = (Объект: Сущность.Объект) -> (Объект как ИндикаторыКомпетенций.Объект).Записать()
        НаборИнструментыМенеджераОбъекта.Добавить(ИнструментыМенеджераОбъекта)
    когда Тип<ШкалыОценок.Ссылка>
        ИнструментыМенеджераОбъекта.ЗаписьОбъекта = (Объект: Сущность.Объект) -> (Объект как ШкалыОценок.Объект).Записать()
        НаборИнструментыМенеджераОбъекта.Добавить(ИнструментыМенеджераОбъекта)
    когда Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.Ссылка>
        ИнструментыМенеджераОбъекта.ЗаписьОбъекта = (Объект: Сущность.Объект) -> (Объект как ЭкземплярыОценкиПерсоналаПоМетоду360.Объект).Записать()
        НаборИнструментыМенеджераОбъекта.Добавить(ИнструментыМенеджераОбъекта)
    ;
    возврат НаборИнструментыМенеджераОбъекта
;

@ВПроекте
@Реализация
метод ПолучитьДанныеJson(ТипОбъекта: Тип, Ссылка: ВходящиеДанные.Ссылка|ИсходящиеДанные.Ссылка, 
        Сервисы: ВебApiСервер.СервисыУпаковкиJson, ВерсияФорматаОбмена: Версия?): Массив<Объект?>
    пер ДанныеJson: Массив<Объект?>
    возврат ДанныеJson
;

@ВПроекте
@Реализация
метод МассивСсылокПоФильтру(ТипОбъекта: Тип, Фильтр: () -> ЧитаемыйМассив<Справочник.Ссылка>): Массив<ЧитаемыйМассив<Справочник.Ссылка>>
    пер МассивСсылок: Массив<ЧитаемыйМассив<Справочник.Ссылка>>
    возврат МассивСсылок
;

@ВПроекте
@Реализация
метод УдалитьОбъекты(ТипОбъекта: Тип, ПараметрыЗапроса: ЧитаемоеСоответствие<Строка, Число|Булево|Ууид|Строка>, Сервисы: ВебApiСервер.СервисыУдаленияОбъектов)
    выбор ТипОбъекта
    когда Тип<БиблиотекиКомпетенций.Ссылка>
        БиблиотекиКомпетенций.УдалитьОбъекты(ПараметрыЗапроса, Сервисы)
    когда Тип<ИндикаторыКомпетенций.Ссылка>
        ИндикаторыКомпетенций.УдалитьОбъекты(ПараметрыЗапроса, Сервисы)
    когда Тип<Компетенции.Ссылка>
        Компетенции.УдалитьОбъекты(ПараметрыЗапроса, Сервисы)
    когда Тип<ШкалыОценок.Ссылка>
        ШкалыОценок.УдалитьОбъекты(ПараметрыЗапроса, Сервисы)            
    ;    
;

@ВПроекте
@Реализация
метод ТипОбъектаJson(ТипОбъекта: Тип): Массив<Строка>
    пер ТипОбъектаJson: Массив<Строка>
    выбор ТипОбъекта
    когда Тип<БиблиотекиКомпетенций.Ссылка>
        ТипОбъектаJson.Добавить(БиблиотекиКомпетенций.ТипОбъектаJson())
    когда Тип<Компетенции.Ссылка>
        ТипОбъектаJson.Добавить(Компетенции.ТипОбъектаJson())
    когда Тип<ИндикаторыКомпетенций.Ссылка>
        ТипОбъектаJson.Добавить(ИндикаторыКомпетенций.ТипОбъектаJson())
    когда Тип<ШкалыОценок.Ссылка>
        ТипОбъектаJson.Добавить(ШкалыОценок.ТипОбъектаJson())
    когда Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.Ссылка>
        ТипОбъектаJson.Добавить(ЭкземплярыОценкиПерсоналаПоМетоду360.ТипОбъектаJson())
    ;
    возврат ТипОбъектаJson
;

@ВПроекте
@Реализация
метод ЗагрузитьОбъектИзJson(ТипОбъекта: Тип, ТипДанных: Тип, ДанныеJson: Объект?, Сервисы: ВебApiСервер.СервисыЗагрузкиJson)
    выбор ТипОбъекта
    когда Тип<БиблиотекиКомпетенций.Ссылка>
        выбор ТипДанных
        когда Тип<БиблиотекиКомпетенций.БиблиотекаКомпетенций_2_0>
            БиблиотекиКомпетенций.ЗагрузитьОбъектИзJson(ДанныеJson как БиблиотекиКомпетенций.БиблиотекаКомпетенций_2_0, Сервисы)
        ;
    когда Тип<Компетенции.Ссылка>
        выбор ТипДанных
        когда Тип<Компетенции.Компетенция_2_0>
            Компетенции.ЗагрузитьОбъектИзJson(ДанныеJson как Компетенции.Компетенция_2_0, Сервисы)
        ;
    когда Тип<ИндикаторыКомпетенций.Ссылка>
        выбор ТипДанных
        когда Тип<ИндикаторыКомпетенций.ИндикаторКомпетенции_2_0>
            ИндикаторыКомпетенций.ЗагрузитьОбъектИзJson(ДанныеJson как ИндикаторыКомпетенций.ИндикаторКомпетенции_2_0, Сервисы)
        ;
    когда Тип<ШкалыОценок.Ссылка>
        выбор ТипДанных
        когда Тип<ШкалыОценок.ШкалаОценки_2_0>
            ШкалыОценок.ЗагрузитьОбъектИзJson(ДанныеJson как ШкалыОценок.ШкалаОценки_2_0, Сервисы)
        ;
    когда Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.Ссылка>
        выбор ТипДанных
        когда Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.ЭкземплярОценкиПерсонала_2_0>
            ЭкземплярыОценкиПерсоналаПоМетоду360.ЗагрузитьОбъектИзJson(ДанныеJson как ЭкземплярыОценкиПерсоналаПоМетоду360.ЭкземплярОценкиПерсонала_2_0, Сервисы)
        ;
    ;
;

@ВПроекте
@Реализация
метод ПослеЗаписиГруппыОбъектов(ТипОбъекта: Тип, МассивОбъектовОтложенногоОбновления: Массив<ВебApiСервер.ОбъектОтложенногоОбновления>)
;

@ВПроекте
@Реализация
метод ИзменитьОбъектИзJson(ТипОбъекта: Тип, ДанныеJson: Объект, Сервисы: ВебApiСервер.СервисыЗагрузкиJson, ЗаданиеМодификации: ВебApiСервер.ЗаданиеМодификации)
;

@ВПроекте
@Реализация
метод ЗавершитьИзменениеОбъектИзJson(ТипОбъекта: Тип, МассивСсылок: ЧитаемыйМассив<ВходящиеДанные.Ссылка>, ЗаданиеМодификации: ВебApiСервер.ЗаданиеМодификации)
;

@ВПроекте
@Реализация
метод ГруппаИзмененийВJson(ТипОбъекта: Тип, Ссылки: ЧитаемаяКоллекция<ИсходящиеДанные.Ссылка>,
    Сервисы: ВебApiСервер.СервисыУпаковкиJson, ВерсияФорматаОбмена: Версия?): Массив<ЧитаемоеСоответствие<Строка, Массив<Объект?>>>
    пер ДанныеJson: Массив<ЧитаемоеСоответствие<Строка, Массив<Объект?>>>
    выбор ТипОбъекта
    когда Тип<БиблиотекиКомпетенций.Ссылка>
        ДанныеJson.Добавить(БиблиотекиКомпетенций.ГруппаИзмененийВJson(Ссылки, Сервисы))
    когда Тип<Компетенции.Ссылка>
        ДанныеJson.Добавить(Компетенции.ГруппаИзмененийВJson(Ссылки, Сервисы))
    когда Тип<ИндикаторыКомпетенций.Ссылка>
        ДанныеJson.Добавить(ИндикаторыКомпетенций.ГруппаИзмененийВJson(Ссылки, Сервисы))
    когда Тип<ШкалыОценок.Ссылка>
        ДанныеJson.Добавить(ШкалыОценок.ГруппаИзмененийВJson(Ссылки, Сервисы))
    когда Тип<ЭкземплярыОценкиПерсоналаПоМетоду360.Ссылка>
        ДанныеJson.Добавить(ЭкземплярыОценкиПерсоналаПоМетоду360.ГруппаИзмененийВJson(Ссылки, Сервисы))
    ;
    возврат ДанныеJson
;

// Конец ДанныеApi

//Контракт КонтрольДоступаПоПолномочиямСервис

@ВПроекте
@Реализация
метод ЗаполнитьПредопределенныеПолномочия()
    ОценкаПерсонала.ДобавитьПолномочия()
;

@ВПроекте
@Реализация
метод ЗаполнитьПредопределенныеРоли()
;

@ВПроекте
@Реализация
метод ЗаполнитьПредопределенныеТипыАтрибутов()
;

@ВПроекте
@Реализация
метод СоздатьНаборыОграниченийДоступа()
;

@ВПроекте
@Реализация
метод ТипыАтрибутовПоТипамЗначений(): ЧитаемоеСоответствие<Тип, ТипыАтрибутов.Ссылка>
    возврат {:}
;

//Конец КонтрольДоступаПоПолномочиямСервис

// Контракт ВторичныеДанные

@ВПроекте
@Реализация
метод Пересчитать()
    ШкалыОценок.ПровестиПервоначальноеЗаполнение()
;

// Конец ВторичныеДанные

// Контракт СтроковыеРесурсыПоставщик

@ВПроекте
@Реализация
метод ИменаРесурсовПоГруппеРесурсов(УчитыватьИспользуемуюФункциональность: Булево): Соответствие<Строка, Коллекция<Строка>>
    если не УчитыватьИспользуемуюФункциональность или ИспользуемаяФункциональность.ПодсистемаИспользуется() 
        возврат {
            ОценкаПерсонала.ГРУППА_РЕСУРСОВ_ОЦЕНКА_ПЕРСОНАЛА: [
                ОценкаПерсонала.НАЧАЛО_ОЦЕНКИ_СОТРУДНИКА_SMS,
                ОценкаПерсонала.НАЧАЛО_ОЦЕНКИ_СОТРУДНИКА_PUSH,
                ОценкаПерсонала.НАЧАЛО_ОЦЕНКИ_СОТРУДНИКА_EMAIL,
                ОценкаПерсонала.НАЧАЛО_ОЦЕНКИ_СОТРУДНИКА_ТЕМА,
        
                ОценкаПерсонала.РЕЗУЛЬТАТЫ_ОЦЕНКИ_СОТРУДНИКА_SMS, 
                ОценкаПерсонала.РЕЗУЛЬТАТЫ_ОЦЕНКИ_СОТРУДНИКА_PUSH, 
                ОценкаПерсонала.РЕЗУЛЬТАТЫ_ОЦЕНКИ_СОТРУДНИКА_EMAIL,
                ОценкаПерсонала.РЕЗУЛЬТАТЫ_ОЦЕНКИ_СОТРУДНИКА_ТЕМА]
        }
    иначе
        возврат {:}
    ;
;

// Конец СтроковыеРесурсыПоставщик