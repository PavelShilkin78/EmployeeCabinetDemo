импорт ОбщиеСтандартные
импорт ФизическиеЛица
импорт КонтрольДоступа
импорт ЛичныеКабинетыПользователей

@Обработчик
метод ПослеСоздания()
    Инициализировать()
    МенеджерГлобальныхКлиентскихСобытий.ПодключитьОбработчик(метод (Источник, Параметры) ->
        если Источник != ФизЛица.ТРЕБУЕТСЯ_ОБНОВЛЕНИЕ_ДАННЫХ_ФИЗИЧЕСКОГО_ЛИЦА
            возврат
        ;
        ПриИзмененииДанныхФизическогоЛица()
    ;)
;

метод УстановленноеФизическоеЛицо(): ФизическиеЛица.Ссылка?
    возврат ЛичныеКабинетыПользователей.ПараметрыСеанса().ТекущееФизическоеЛицо
;

метод Инициализировать()
    пер УстановленноеФизическоеЛицо: ФизическиеЛица.Ссылка? = ЛичныеКабинетыПользователей.ПараметрыСеанса().ТекущееФизическоеЛицо
    если УстановленноеФизическоеЛицо == Неопределено
        возврат
    ;
    пер ДанныеЛистов = ДанныеПоследнихМесяцев(ЛичныеКабинетыПользователей.ПараметрыСеанса().ТекущееФизическоеЛицо)
    если ДанныеЛистов.Размер() > 0
        ДанныеТекущегоМесяца = ДанныеЛистов[0]
    ; 
;

метод ПриИзмененииДанныхФизическогоЛица()
    Инициализировать()
;

метод РасчетныеЛистыОтсутствуютВидимость(): Булево
    возврат не РасчетныйЛистТекущегоМесяцаКонтейнерВидимость() 
;

метод РасчетныйЛистТекущегоМесяцаКонтейнерВидимость(): Булево
    возврат ДанныеТекущегоМесяца.РасчетныйЛист != Неопределено 
; 

/*метод РасчетныйЛистПредыдущегоМесяцаКонтейнерВидимость(): Булево
    возврат ДанныеПредыдущегоМесяца.РасчетныйЛист != Неопределено и РасчетныйЛистТекущегоМесяцаКонтейнерВидимость() 
; 

метод РасчетныйЛистПредыдущегоМесяцаПустойВидимость(): Булево
    возврат ДанныеПредыдущегоМесяца.РасчетныйЛист == Неопределено и не РасчетныеЛистыОтсутствуютВидимость() 
;*/

метод РасчетныеЛистыОтсутствуютЗаголовок(): Строка
    пер ТекстЗаголовка: Строка
    если ДанныеТекущегоМесяца.РасчетныйЛист == Неопределено
        ТекстЗаголовка = "Здесь будут отображаться данные о ваших выплатах. Сейчас информации нет - она появится позже."
    ; 
    возврат ТекстЗаголовка
;

@НаСервере @ДоступноСКлиента
статический метод ДанныеПоследнихМесяцев(ФизическоеЛицо: ФизическиеЛица.Ссылка): Массив<КраткийРасчетныйЛист>
    возврат Сервер.КраткиеРасчетныеЛисты(ФизическоеЛицо, 1)
;