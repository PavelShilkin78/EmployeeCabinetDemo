импорт ВебApi
импорт КонтрольДоступа

//Область РазрешенияДоступа

@Обработчик
метод ВычислитьРазрешенияДоступа(): Массив<РазрешениеДоступа>
    возврат [КонтрольДоступа.ЧтениеАутентифицированным(этот),
            КонтрольДоступа.ПолныйДоступИнформационнойСистеме(этот)]    
;

@Обработчик
метод ВычислитьРазрешенияДоступаДляОбъектов(Элементы: ЧитаемыйМассив<ОплатаТрудаСотрудников.ДанныеРасчетаРазрешений>): ЧитаемоеСоответствие<ОплатаТрудаСотрудников.ДанныеРасчетаРазрешений, ЧитаемаяКоллекция<РазрешениеДоступа>>
    знч Разрешения: Соответствие<ОплатаТрудаСотрудников.ДанныеРасчетаРазрешений, ЧитаемаяКоллекция<РазрешениеДоступа>>
    для Элемент из Элементы
        знч РазрешенияЭлемента: Множество<РазрешениеДоступа>
        РазрешенияЭлемента.Добавить(КонтрольДоступа.ПолныйДоступИнформационнойСистеме(этот))
        РазрешенияЭлемента.ДобавитьВсе(КонтрольДоступа.ЧтениеДанныхСправочниковПоПолномочиям(
            [КонтрольДоступа.ПолномочиеПросмотрЛичныхДанных()],
            Элемент.ФизическоеЛицо
        ))
        Разрешения.Вставить(Элемент, РазрешенияЭлемента)
    ;
    возврат Разрешения
;

//КонецОбласти

//Область JSON

@ВПодсистеме
структура ДанныеJson
    обз знч value: Число?
    обз знч presentation: Строка?
;

@ВПодсистеме
метод ТипОбъектаJson(): Строка
    возврат "employees"
;

@ВПодсистеме
метод ЗагрузитьОбъектИзJsonДанныхСотрудника(ДанныеJson: Сотрудники.Сотрудник_1_0, Сервисы: ВебApiСервер.СервисыЗагрузкиJson,
    Владелец: Сотрудники.Ссылка)

    знч ОплатаТрудаНабор: Массив<Справочник.Объект>
    знч Ключ = {"Владелец": Владелец}

    если ДанныеJson.ОплатаТруда != Неопределено
        знч ОплатаТруда = новый ОплатаТрудаСотрудников.Объект()
        ОплатаТруда.Владелец = Владелец
        ОплатаТруда.ТарифнаяСтавка = ДанныеJson.ОплатаТруда.value ?? 0
        ОплатаТруда.ПредставлениеТарифнойСтавки = ДанныеJson.ОплатаТруда.presentation ?? ""
        ОплатаТрудаНабор.Добавить(ОплатаТруда)
    ;
    Сервисы.ЗаписатьКоллекцию(ОплатаТрудаНабор, Ключ, Тип<ОплатаТрудаСотрудников.Ссылка>, новый ВебApiСервер.ИнструментыМенеджераОбъекта(
        (Объект: Сущность.Объект) -> (Объект как ОплатаТрудаСотрудников.Объект).Записать()
    ))
;

@ВПодсистеме
метод ЗагрузитьОбъектИзJsonДанныхСотрудника(ДанныеJson: Сотрудники.Сотрудник_3_0, Сервисы: ВебApiСервер.СервисыЗагрузкиJson,
    Владелец: Сотрудники.Ссылка)

    знч ОплатаТрудаНабор: Массив<Справочник.Объект>
    знч Ключ = {"Владелец": Владелец}

    если ДанныеJson.ОплатаТруда != Неопределено
        знч ОплатаТруда = новый ОплатаТрудаСотрудников.Объект()
        ОплатаТруда.Владелец = Владелец
        ОплатаТруда.ТарифнаяСтавка = ДанныеJson.ОплатаТруда.value ?? 0
        ОплатаТруда.ПредставлениеТарифнойСтавки = ДанныеJson.ОплатаТруда.presentation ?? ""
        ОплатаТрудаНабор.Добавить(ОплатаТруда)
    ;
    Сервисы.ЗаписатьКоллекцию(ОплатаТрудаНабор, Ключ, Тип<ОплатаТрудаСотрудников.Ссылка>, новый ВебApiСервер.ИнструментыМенеджераОбъекта(
        (Объект: Сущность.Объект) -> (Объект как ОплатаТрудаСотрудников.Объект).Записать()
    ))
;

//КонецОбласти