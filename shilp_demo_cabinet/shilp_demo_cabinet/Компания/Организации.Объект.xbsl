импорт ВебApi
импорт ФизическиеЛица

//Область ОбработчикиСобытий

@Обработчик
@ВыполнятьПриЗагрузкеДанных
метод ПередЗаписью(ПредыдущееЗначение: Организации.Данные, ПараметрыЗаписи: Организации.ПараметрыЗаписи)
    ЗаполнитьГоловнуюОрганизацию()
;

//КонецОбласти

@ВПодсистеме
метод ЗаполнитьПоДаннымJSON(ДанныеJSON: Организации.ДанныеJson, Сервисы: ВебApiСервер.СервисыЗагрузкиJson)
    этот.Наименование = ДанныеJSON.name
    этот.ИНН = ДанныеJSON.taxID ?? ""
    этот.ЭтоФилиал = ДанныеJSON.isBranch ?? Ложь
    если ДанныеJSON.parentOrganizationID != Неопределено и ДанныеJSON.parentOrganizationID != ДанныеJSON.ID
        этот.ГоловнаяОрганизация = Сервисы.ПолучитьСсылку(Организации.ВнешняяСсылка(ДанныеJSON.parentOrganizationID)) как Организации.Ссылка
    иначе
        этот.ГоловнаяОрганизация = Неопределено
    ;
;

@ВПодсистеме
метод ЗаполнитьПоДаннымJSON(ДанныеJson: Организации.ДанныеJson_V2_0, Сервисы: ВебApiСервер.СервисыЗагрузкиJson)
    этот.Наименование = ДанныеJson.name
    этот.ИНН = ДанныеJson.taxID ?? ""
    этот.ЭтоФилиал = ДанныеJson.isBranch ?? Ложь
    этот.НаименованиеПолное = ДанныеJson.fullName ?? ""
    этот.ОГРН = ДанныеJson.primaryStateRegistrationNumber ?? ""
    этот.КПП = ДанныеJson.taxRegistrationReasonCode ?? ""
    
    знч ВнешниеСсылки: Множество<ВебApiСервер.ВнешняяСсылка>
    если ДанныеJson.parentOrganizationID != Неопределено
        ВнешниеСсылки.Добавить(Организации.ВнешняяСсылка(ДанныеJson.parentOrganizationID))
    ;
    если ДанныеJson.principalID != Неопределено
        ВнешниеСсылки.Добавить(ФизическиеЛица.ВнешняяСсылка(ДанныеJson.principalID))
    ;
    если ДанныеJson.positionOfprincipalID != Неопределено
        ВнешниеСсылки.Добавить(Должности.ВнешняяСсылка(ДанныеJson.positionOfprincipalID))
    ;
    если не ВнешниеСсылки.Пусто()
        Сервисы.ПолучитьСсылки(ВнешниеСсылки)
        
        если ДанныеJson.parentOrganizationID != Неопределено и ДанныеJson.parentOrganizationID != ДанныеJson.ID
            этот.ГоловнаяОрганизация = Сервисы.ПолучитьСсылку(
                Организации.ВнешняяСсылка(ДанныеJson.parentOrganizationID)) как Организации.Ссылка
        иначе
            этот.ГоловнаяОрганизация = Неопределено
        ;
        если ДанныеJson.principalID != Неопределено
            этот.Руководитель = Сервисы.ПолучитьСсылку(
                ФизическиеЛица.ВнешняяСсылка(ДанныеJson.principalID)) как ФизическиеЛица.Ссылка
            если ДанныеJson.positionOfprincipalID != Неопределено
                этот.ДолжностьРуководителя = Сервисы.ПолучитьСсылку(
                    Должности.ВнешняяСсылка(ДанныеJson.positionOfprincipalID)) как Должности.Ссылка
            иначе
                этот.ДолжностьРуководителя = Неопределено
            ;
        иначе
            этот.Руководитель = Неопределено
            этот.ДолжностьРуководителя = Неопределено
        ;
    ;
;

@ВПодсистеме
метод ЗаполнитьПоДаннымJSON(ДанныеJson: Организации.ДанныеJson_V2_2, Сервисы: ВебApiСервер.СервисыЗагрузкиJson)
    этот.Наименование = ДанныеJson.name
    этот.ИНН = ДанныеJson.taxID ?? ""
    этот.ЭтоФилиал = ДанныеJson.isBranch ?? Ложь
    этот.НаименованиеПолное = ДанныеJson.fullName ?? ""
    этот.НаименованиеСокращенное = ДанныеJson.shortName ?? этот.НаименованиеПолное
    этот.ОГРН = ДанныеJson.primaryStateRegistrationNumber ?? ""
    этот.КПП = ДанныеJson.taxRegistrationReasonCode ?? ""
    
    знч ВнешниеСсылки: Множество<ВебApiСервер.ВнешняяСсылка>
    если ДанныеJson.parentOrganizationID != Неопределено
        ВнешниеСсылки.Добавить(Организации.ВнешняяСсылка(ДанныеJson.parentOrganizationID))
    ;
    если ДанныеJson.principalID != Неопределено
        ВнешниеСсылки.Добавить(ФизическиеЛица.ВнешняяСсылка(ДанныеJson.principalID))
    ;
    если ДанныеJson.positionOfprincipalID != Неопределено
        ВнешниеСсылки.Добавить(Должности.ВнешняяСсылка(ДанныеJson.positionOfprincipalID))
    ;
    если не ВнешниеСсылки.Пусто()
        Сервисы.ПолучитьСсылки(ВнешниеСсылки)
        
        если ДанныеJson.parentOrganizationID != Неопределено и ДанныеJson.parentOrganizationID != ДанныеJson.ID
            этот.ГоловнаяОрганизация = Сервисы.ПолучитьСсылку(
                Организации.ВнешняяСсылка(ДанныеJson.parentOrganizationID)) как Организации.Ссылка
        иначе
            этот.ГоловнаяОрганизация = Неопределено
        ;
        если ДанныеJson.principalID != Неопределено
            этот.Руководитель = Сервисы.ПолучитьСсылку(
                ФизическиеЛица.ВнешняяСсылка(ДанныеJson.principalID)) как ФизическиеЛица.Ссылка
            если ДанныеJson.positionOfprincipalID != Неопределено
                этот.ДолжностьРуководителя = Сервисы.ПолучитьСсылку(
                    Должности.ВнешняяСсылка(ДанныеJson.positionOfprincipalID)) как Должности.Ссылка
            иначе
                этот.ДолжностьРуководителя = Неопределено
            ;
        иначе
            этот.Руководитель = Неопределено
            этот.ДолжностьРуководителя = Неопределено
        ;
    ;
;

//Область СлужебныеПроцедурыИФункции

метод ЗаполнитьГоловнуюОрганизацию()
    если ГоловнаяОрганизация == Неопределено
        ГоловнаяОрганизация = Ссылка
        ЭтоФилиал = Ложь
    иначе
        если ГоловнаяОрганизация != Ссылка
            ЭтоФилиал = Истина
        ;
    ;
;

//КонецОбласти