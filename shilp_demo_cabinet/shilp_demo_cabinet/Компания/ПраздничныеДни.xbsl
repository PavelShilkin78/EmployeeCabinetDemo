импорт ВебApi
импорт КонтрольДоступа

//Область РазрешенияДоступа

@Обработчик
метод ВычислитьРазрешенияДоступа(): Массив<РазрешениеДоступа>
    возврат КонтрольДоступа.РазрешенияДоступаТаблицыКонтентДанныхАбонентаЧтениеВсем()
;

//КонецОбласти

//Область СлужебныйПрограммныйИнтерфейс

@ВПроекте
структура ДанныеJson
    обз знч workScheduleID: Строка
    обз знч components: ЧитаемыйМассив<ПраздничныйДеньJson>?
;

@ВПодсистеме
структура ПраздничныйДеньJson
    обз знч year: Число
    обз знч date: ДатаВремя?
;

@ВПодсистеме
метод ТипДанныхJson(ВерсияФорматаОбмена: Версия?): Тип
    если ВерсияФорматаОбмена == Неопределено
        возврат Тип<ДанныеJson>
    иначе если ВерсияФорматаОбмена >= Версия{1.0}
        возврат Тип<ДанныеJson>
    ;
;

@ВПодсистеме
метод ТипКоллекцииДанныхJson(ВерсияФорматаОбмена: Версия?): Тип
    если ВерсияФорматаОбмена == Неопределено
        возврат Тип<Массив<ДанныеJson>>
    иначе если ВерсияФорматаОбмена >= Версия{1.0}
        возврат Тип<Массив<ДанныеJson>>
    ;
;

@ВПодсистеме
метод ТипОбъектаJson(): Строка
    возврат "holidays"
;

@ВПодсистеме
метод ЗагрузитьОбъектИзJson(ДанныеJson: ДанныеJson, Сервисы: ВебApiСервер.СервисыЗагрузкиJson)

    исп Транзакции.Начать() 

    знч СтрокиГрафика: Массив<Справочник.Объект>

    знч Ключ: Соответствие<Строка, Объект>
    Ключ.Вставить("ГрафикРаботы", Сервисы.ПолучитьСсылку(ГрафикиРаботы.ВнешняяСсылка(ДанныеJson.workScheduleID)))
    
    если ДанныеJson.components != Неопределено
        для ДанныеСтрокиJson из ДанныеJson.components
            знч СтрокаГрафика = новый ПраздничныеДни.Объект()
            СтрокаГрафика.ГрафикРаботы = Ключ["ГрафикРаботы"] как ГрафикиРаботы.Ссылка
            СтрокаГрафика.Год = ДанныеСтрокиJson.year
            СтрокаГрафика.Дата = ДанныеСтрокиJson.date.Дата
            СтрокиГрафика.Добавить(СтрокаГрафика)
        ;
    ;
    Сервисы.ЗаписатьКоллекцию(СтрокиГрафика, Ключ, Тип<ПраздничныеДни.Ссылка>, Сервисы.ИнструментыМенеджераОбъекта)

;

@ВПодсистеме
метод УдалитьОбъекты(ПараметрыЗапроса: ЧитаемоеСоответствие<Строка, Число|Булево|Ууид|Строка>, Сервисы: ВебApiСервер.СервисыУдаленияОбъектов)
    
    знч Ключ = {"ГрафикРаботы": Сервисы.ПолучитьСсылку(ГрафикиРаботы.ВнешняяСсылка(ПараметрыЗапроса["workScheduleID"] как Строка))}
    Сервисы.УдалитьКоллекцию(Ключ, Тип<ПраздничныеДни.Ссылка>)

;

//КонецОбласти

//Область СлужебныеПроцедурыИФункции

//КонецОбласти